---
import "../styles/tailwind.css";
import "animate.css";
const title = "Welcome | Portfolio";
---

<html lang="da">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />

    <!-- ✅ Alpine.js + GSAP CDN -->
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js" defer></script>

    <title>{title}</title>
  </head>

  <body class="bg-black text-white overflow-hidden h-screen">
    <main class="relative h-full w-full" x-data="doorScene()" x-init="updateBeam(); window.addEventListener('resize', updateBeam)">
      
      <!-- 🔹 link -->
      <div class="select-none absolute left-6 md:left-10 top-1/3 z-20 text-[12px] md:text-sm text-gray-300 space-y-3">
        <a href="/aboutme" @click.prevent="openLink($event)">Om mig</a>
        <a href="/projects" @click.prevent="openLink($event)">Projekter</a>
        <a href="/lejeplads" @click.prevent="openLink($event)">Lejeplads</a>
      </div>

      <!-- 🔹 Camera secene -->
      <div id="camera" class="h-full w-full grid place-items-center [perspective:1400px]">
        
        <!-- Enterence -->
        <h2 class="absolute top-[16%] text-lime-400 text-base md:text-xl tracking-wide z-30">
          Enter my room
        </h2>

        <!-- Door(Stage) -->
        <div id="stage" class="relative z-30">
          <div
            id="door"
            @click.prevent.stop="open"
            class="relative w-[clamp(80px,12vw,160px)] aspect-[2/3] border border-white bg-black cursor-pointer [transform-style:preserve-3d] origin-left will-change-transform"
            style="box-shadow: 0 0 0 1px rgba(255,255,255,.15) inset; backface-visibility: visible;"
          >
            <!-- Front of door -->
            <div class="absolute inset-0 bg-black"></div>

            <!-- Door inner -->
            <div
              id="door-inner"
              class="absolute inset-0 bg-white"
              style="transform: rotateY(180deg) translateZ(0.1px); backface-visibility: visible;"
            ></div>

            <!-- handle of door -->
            <div
              id="handle"
              class="absolute right-[14%] top-1/2 w-[12px] h-[12px] md:w-[16px] md:h-[16px] rounded-full border border-white/90"
              style="transform: translateY(-50%) translateZ(2px);"
            ></div>
          </div>

          <!-- Door frame -->
          <div
            aria-hidden
            class="absolute inset-0 -z-10 w-[clamp(82px,12.2vw,164px)] aspect-[2/3] border border-white/30 translate-x-[2px] translate-y-[2px]"
          ></div>
        </div>

        <!-- Shadow light -->
        <div
          id="beam"
          class="pointer-events-none absolute inset-0 z-20 opacity-0 transition-opacity duration-300"
          style="
            --lx: 50vw;
            --rx: 50vw;
            --y: 62vh;
            background: radial-gradient(1200px 700px at 50% var(--y), rgba(255,255,255,0.85) 0%, rgba(255,255,255,0.6) 25%, rgba(150,150,150,0.25) 50%, rgba(0,0,0,0) 100%);
            -webkit-clip-path: polygon(0% 100%, 100% 100%, var(--rx) var(--y), var(--lx) var(--y));
            clip-path: polygon(0% 100%, 100% 100%, var(--rx) var(--y), var(--lx) var(--y));
            mix-blend-mode: screen;
          "
        ></div>
      </div>

      <!-- Fade overlay -->
      <div id="overlay" class="absolute inset-0 bg-black opacity-0 pointer-events-none z-50"></div>
    </main>

    <!-- ✅ Alpine + GSAP Script -->
    <script>
      document.addEventListener("alpine:init", () => {
        Alpine.data("doorScene", () => ({
          targetUrl: "/aboutme", // 기본 클릭 시 이동할 페이지
          isAnimating: false,

          updateBeam() {
            const door = document.getElementById("door");
            const beam = document.getElementById("beam");
            if (!door || !beam) return;
            const r = door.getBoundingClientRect();
            beam.style.setProperty("--lx", r.left + "px");
            beam.style.setProperty("--rx", r.right + "px");
            beam.style.setProperty("--y", (r.bottom - 5) + "px");
          },

          // 🔹 문 클릭 시 (기본 /aboutme)
          open(event) {
            event.preventDefault();
            if (this.isAnimating) return;
            this.isAnimating = true;

            const door = document.getElementById("door");
            const inner = document.getElementById("door-inner");
            const camera = document.getElementById("camera");
            const beam = document.getElementById("beam");
            const overlay = document.getElementById("overlay");
            const stage = document.getElementById("stage");

            this.updateBeam();

            const tl = gsap.timeline({ defaults: { ease: "power3.out" } });

            // 1️⃣ Open door
            tl.to(door, {
              duration: 1.2,
              rotateY: -78,
              transformOrigin: "left center",
              ease: "power2.out",
              boxShadow: "0 0 24px rgba(255,255,255,0.25) inset"
            }, 0);

            // 2️⃣ Light beam
            tl.to(beam, { duration: 1.0, opacity: 1, ease: "power2.out" }, 0.05);

            // 3️⃣ Door inner brighten
            tl.to(inner, {
              duration: 1.0,
              backgroundColor: "rgba(255,255,255,0.95)",
              ease: "power2.out",
            }, 0.05);

            // 4️⃣ Camera moving to center
            const rect = stage.getBoundingClientRect();
            const dx = window.innerWidth / 2 - (rect.left + rect.width / 2);
            const dy = window.innerHeight / 2 - (rect.top + rect.height / 2);

            tl.to("#camera", {
              duration: 0.8,
              x: dx,
              y: dy,
              ease: "power3.inOut"
            }, 0.4);

            // 5️⃣ Zoom in and page transition
            tl.to("#camera", {
              duration: 1.0,
              scale: 5.5,
              ease: "power3.in",
              onComplete: () => {
                window.location.assign(this.targetUrl);
              }
            }, 0.9);
          },

          // 🔹 링크 클릭 시: 클릭된 href로 targetUrl 설정 후 open() 실행
          openLink(event) {
            event.preventDefault();
            const href = event.currentTarget.getAttribute("href");
            this.targetUrl = href; // 클릭된 링크 주소 저장
            this.open(event); // 문 열림 애니메이션 실행
          },
        }));
      });
    </script>
  </body>
</html>
